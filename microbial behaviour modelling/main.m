close all
clear all
Xt=[4.8       , 4.82036581, 4.8406043 , 4.86071447, 4.88069537,4.90054609, 4.92026575, 4.93985352, 4.9593086 , 4.97863024,4.99781772, 5.01687038, 5.03578756, 5.05456866, 5.07321313,       5.09172045, 5.11009011, 5.12832167, 5.14641472, 5.16436888,       5.1821838 , 5.19985917, 5.21739474, 5.23479024, 5.25204549,       5.26916031, 5.28613456, 5.30296814, 5.31966098, 5.33621303,       5.35262427, 5.36889474, 5.38502449, 5.40101358, 5.41686213,      5.43257028, 5.44813819, 5.46356606, 5.47885409, 5.49400254,      5.50901168, 5.5238818 , 5.53861323, 5.5532063 , 5.56766138,       5.58197888, 5.59615919, 5.61020275, 5.62411002, 5.63788148,       5.65151762, 5.66501896, 5.67838602, 5.69161938, 5.70471959,       5.71768725, 5.73052296, 5.74322734, 5.75580103, 5.76824468,       5.78055896, 5.79274455, 5.80480214, 5.81673245, 5.8285362 ,       5.84021411, 5.85176693, 5.86319541, 5.87450033, 5.88568246,       5.89674259, 5.90768151, 5.91850002, 5.92919894, 5.93977909,       5.95024129, 5.96058639, 5.97081523, 5.98092865, 5.99092751,       6.00081266, 6.01058498, 6.02024533, 6.02979459, 6.03923363,       6.04856334, 6.0577846 , 6.0668983 , 6.07590534, 6.08480659,       6.09360297, 6.10229536, 6.11088467, 6.11937179, 6.12775763,       6.13604308, 6.14422904, 6.15231642, 6.16030612, 6.16819904,       6.17599607, 6.18369812, 6.19130608, 6.19882085, 6.20624332,       6.21357439, 6.22081494, 6.22796587, 6.23502805, 6.24200237,       6.24888972, 6.25569096, 6.26240697, 6.26903863, 6.27558679,       6.28205232, 6.28843609, 6.29473894, 6.30096174, 6.30710531,       6.31317052, 6.31915819, 6.32506916, 6.33090427, 6.33666433,       6.34235016, 6.34796259, 6.35350241, 6.35897044, 6.36436747,       6.36969429, 6.37495171, 6.38014049, 6.38526142, 6.39031527,       6.39530281, 6.4002248 , 6.40508199, 6.40987513, 6.41460497,       6.41927224, 6.42387768, 6.42842201, 6.43290596, 6.43733023,       6.44169554, 6.44600258, 6.45025207, 6.45444467, 6.45858109,       6.46266199, 6.46668805, 6.47065993, 6.4745783 , 6.47844381,       6.4822571 , 6.48601883, 6.48972961, 6.49339009, 6.49700088,       6.5005626 , 6.50407587, 6.50754129, 6.51095946, 6.51433097,       6.5176564 , 6.52093635, 6.52417138, 6.52736206, 6.53050896,       6.53361264, 6.53667364, 6.53969251, 6.54266979, 6.54560602,       6.54850172, 6.55135742, 6.55417363, 6.55695087, 6.55968964,       6.56239043, 6.56505376, 6.56768009, 6.57026992, 6.57282373,      6.57534198, 6.57782515, 6.58027369, 6.58268807, 6.58506873,      6.58741612, 6.58973068, 6.59201284, 6.59426305, 6.59648171,      6.59866926, 6.60082611, 6.60295266, 6.60504933, 6.60711652,      6.60915461, 6.61116401, 6.6131451 , 6.61509825, 6.61702385,      6.61892228, 6.62079389, 6.62263905, 6.62445811, 6.62625145,      6.6280194 , 6.6297623 , 6.63148051, 6.63317436, 6.63484417,      6.63649029, 6.63811303, 6.63971272, 6.64128966, 6.64284418,      6.64437658, 6.64588717, 6.64737624, 6.64884409, 6.65029102,      6.65171732, 6.65312327, 6.65450915, 6.65587523, 6.65722181,      6.65854914, 6.65985749, 6.66114712, 6.66241831, 6.6636713 ,       6.66490634, 6.66612369, 6.6673236 , 6.66850631, 6.66967205,       6.67082107, 6.6719536 , 6.67306987, 6.67417011, 6.67525455,       6.6763234 , 6.67737688, 6.67841522, 6.67943862, 6.68044729,       6.68144145, 6.68242129, 6.68338702, 6.68433884, 6.68527694,       6.68620152, 6.68711277, 6.68801087, 6.68889602, 6.6897684 ,       6.69062818, 6.69147555, 6.69231068, 6.69313375, 6.69394493,      6.69474438, 6.69553227, 6.69630877, 6.69707405, 6.69782825,       6.69857153, 6.69930406, 6.70002599, 6.70073746, 6.70143863,       6.70212964, 6.70281064, 6.70348177, 6.70414318, 6.70479499,       6.70543736, 6.7060704 , 6.70669427, 6.70730908, 6.70791497,       6.70851207, 6.7091005 , 6.70968038, 6.71025185, 6.71081501,       6.71137   , 6.71191692, 6.71245589, 6.71298703, 6.71351045,       6.71402626, 6.71453457, 6.71503549, 6.71552912, 6.71601557,       6.71649494, 6.71696733, 6.71743286, 6.7178916 , 6.71834367,       6.71878915, 6.71922815, 6.71966076, 6.72008706, 6.72050715,       6.72092113, 6.72132907, 6.72173106, 6.7221272 , 6.72251756,       6.72290223, 6.7232813 , 6.72365484, 6.72402292, 6.72438565,       6.72474308, 6.72509529, 6.72544237, 6.72578438, 6.7261214 ,      6.72645351, 6.72678077, 6.72710325, 6.72742102, 6.72773415,      6.72804271, 6.72834677, 6.72864638, 6.72894162, 6.72923255,      6.72951923, 6.72980171, 6.73008008, 6.73035437, 6.73062466,       6.73089099, 6.73115344, 6.73141205, 6.73166688, 6.73191798,       6.73216541, 6.73240923, 6.73264948, 6.73288621, 6.73311949,       6.73334935, 6.73357585, 6.73379904, 6.73401897, 6.73423567,       6.73444921, 6.73465962, 6.73486696, 6.73507126, 6.73527257,       6.73547093, 6.73566639, 6.73585899, 6.73604877, 6.73623578,       6.73642004, 6.73660161, 6.73678052, 6.73695682, 6.73713053,       6.73730169, 6.73747035, 6.73763654, 6.7378003 , 6.73796166,       6.73812065, 6.73827732, 6.73843169, 6.7385838 , 6.73873369,       6.73888137, 6.7390269 , 6.73917029, 6.73931158, 6.7394508 ,       6.73958798, 6.73972315, 6.73985634, 6.73998758, 6.74011689,       6.74024431, 6.74036986, 6.74049358, 6.74061547, 6.74073559,       6.74085394, 6.74097055, 6.74108546, 6.74119868, 6.74131025,       6.74142017, 6.74152849, 6.74163522, 6.74174038, 6.741844  ,       6.7419461 , 6.74204671, 6.74214583, 6.74224351, 6.74233975,      6.74243458, 6.74252803, 6.7426201 , 6.74271082, 6.74280021,       6.74288828, 6.74297507, 6.74306058, 6.74314484, 6.74322787,      6.74330967, 6.74339028, 6.7434697 , 6.74354796, 6.74362507,       6.74370105, 6.74377591, 6.74384968, 6.74392236, 6.74399398, 6.74406454, 6.74413407, 6.74420258, 6.74427009, 6.7443366 , 6.74440214, 6.74446672, 6.74453035, 6.74459305, 6.74465482, 6.74471569, 6.74477567, 6.74483476, 6.74489299, 6.74495036, 6.74500689, 6.7450626 , 6.74511748, 6.74517156, 6.74522485, 6.74527735, 6.74532908, 6.74538005, 6.74543028, 6.74547977,6.74552853, 6.74557657, 6.74562391, 6.74567056, 6.74571652,6.7457618 , 6.74580643, 6.74585039, 6.74589371, 6.7459364 ,6.74597846, 6.7460199 , 6.74606073, 6.74610096, 6.7461406 ,6.74617966, 6.74621815, 6.74625607, 6.74629344, 6.74633025,6.74636653, 6.74640227, 6.74643749, 6.74647219, 6.74650638,6.74654007, 6.74657326, 6.74660597, 6.7466382 , 6.74666995,6.74670124, 6.74673207, 6.74676244, 6.74679237, 6.74682186,6.74685092, 6.74687955, 6.74690776, 6.74693556, 6.74696294,6.74698993, 6.74701652, 6.74704272, 6.74706853, 6.74709396,6.74711902];
Nsamples=500;
dt = .048;
t=0:dt:dt*Nsamples;
Xkp = [4;0];
Xk=[];
Phi = [1 dt; 0 1]; 
sm = 1;
P = [sm^2 0; 0 sm^2];
Q = [0 0; 0 0];
M = [1 0]; 
R = 1;
Xkb = zeros(2,Nsamples+1);
Xkb(:,1) = Xkp;
noise = zeros(1,Nsamples+1);
for k=1:Nsamples
    Z = Xt(k+1)+randn;
    noise(k+1) = Z;
    P1 = Phi*P*Phi' + Q;
    S = M*P1*M' + R;
    K = P1*M'*inv(S);
    P = P1 - K*M*P1;   
    Xk = Phi*Xkp + K*(Z-M*Phi*Xkp);
    Xkb(:,k+1) = Xk;
    Xkp = Xk; 
end;
figure;
plot(t,Xt,'g');
hold on;
plot(t,noise,'c');
plot(t,Xkb(1,:),'m');
title('BACTERIA GROWTH estimation results');
xlabel('Time (s)');
ylabel('Bacteria growth');
%legend('True Growth','Measurements of growth','Kalman growth estimate');
S1=zeros(501,1);
for i=2:length(Xkb)-1
    a1=(Xkb(1,i+1)-Xkb(1,i));
    a2=((Xkb(1,i+1))-(2*(Xkb(1,i)))+(Xkb(1,i-1)));
    a3=(Xkb(1,i)-Xkb(1,i-1));
    S1(i-1)=((a1)-(.0000000011253)*dt*(a2)/a3)/dt;
end

q = zeros(1,500);
umax=.033*(298-277.69)^2;
Xmax=.608*298.5-11.4;
for i=1:499
    q(i)=S1(i)/(umax*Xkb(1,i)*(1-Xkb(1,i)/Xmax)-S1(i));
end
q1=(q-.0009*298*298+.2565*298-24.82)/(298^3);
figure(2)
plot(q1)
q11=mean(q1)
q111=std(q1)













%Xt=[4.8       , 4.82036581, 4.8406043 , 4.86071447, 4.88069537,4.90054609, 4.92026575, 4.93985352, 4.9593086 , 4.97863024,4.99781772, 5.01687038, 5.03578756, 5.05456866, 5.07321313,       5.09172045, 5.11009011, 5.12832167, 5.14641472, 5.16436888,       5.1821838 , 5.19985917, 5.21739474, 5.23479024, 5.25204549,       5.26916031, 5.28613456, 5.30296814, 5.31966098, 5.33621303,       5.35262427, 5.36889474, 5.38502449, 5.40101358, 5.41686213,      5.43257028, 5.44813819, 5.46356606, 5.47885409, 5.49400254,      5.50901168, 5.5238818 , 5.53861323, 5.5532063 , 5.56766138,       5.58197888, 5.59615919, 5.61020275, 5.62411002, 5.63788148,       5.65151762, 5.66501896, 5.67838602, 5.69161938, 5.70471959,       5.71768725, 5.73052296, 5.74322734, 5.75580103, 5.76824468,       5.78055896, 5.79274455, 5.80480214, 5.81673245, 5.8285362 ,       5.84021411, 5.85176693, 5.86319541, 5.87450033, 5.88568246,       5.89674259, 5.90768151, 5.91850002, 5.92919894, 5.93977909,       5.95024129, 5.96058639, 5.97081523, 5.98092865, 5.99092751,       6.00081266, 6.01058498, 6.02024533, 6.02979459, 6.03923363,       6.04856334, 6.0577846 , 6.0668983 , 6.07590534, 6.08480659,       6.09360297, 6.10229536, 6.11088467, 6.11937179, 6.12775763,       6.13604308, 6.14422904, 6.15231642, 6.16030612, 6.16819904,       6.17599607, 6.18369812, 6.19130608, 6.19882085, 6.20624332,       6.21357439, 6.22081494, 6.22796587, 6.23502805, 6.24200237,       6.24888972, 6.25569096, 6.26240697, 6.26903863, 6.27558679,       6.28205232, 6.28843609, 6.29473894, 6.30096174, 6.30710531,       6.31317052, 6.31915819, 6.32506916, 6.33090427, 6.33666433,       6.34235016, 6.34796259, 6.35350241, 6.35897044, 6.36436747,       6.36969429, 6.37495171, 6.38014049, 6.38526142, 6.39031527,       6.39530281, 6.4002248 , 6.40508199, 6.40987513, 6.41460497,       6.41927224, 6.42387768, 6.42842201, 6.43290596, 6.43733023,       6.44169554, 6.44600258, 6.45025207, 6.45444467, 6.45858109,       6.46266199, 6.46668805, 6.47065993, 6.4745783 , 6.47844381,       6.4822571 , 6.48601883, 6.48972961, 6.49339009, 6.49700088,       6.5005626 , 6.50407587, 6.50754129, 6.51095946, 6.51433097,       6.5176564 , 6.52093635, 6.52417138, 6.52736206, 6.53050896,       6.53361264, 6.53667364, 6.53969251, 6.54266979, 6.54560602,       6.54850172, 6.55135742, 6.55417363, 6.55695087, 6.55968964,       6.56239043, 6.56505376, 6.56768009, 6.57026992, 6.57282373,      6.57534198, 6.57782515, 6.58027369, 6.58268807, 6.58506873,      6.58741612, 6.58973068, 6.59201284, 6.59426305, 6.59648171,      6.59866926, 6.60082611, 6.60295266, 6.60504933, 6.60711652,      6.60915461, 6.61116401, 6.6131451 , 6.61509825, 6.61702385,      6.61892228, 6.62079389, 6.62263905, 6.62445811, 6.62625145,      6.6280194 , 6.6297623 , 6.63148051, 6.63317436, 6.63484417,      6.63649029, 6.63811303, 6.63971272, 6.64128966, 6.64284418,      6.64437658, 6.64588717, 6.64737624, 6.64884409, 6.65029102,      6.65171732, 6.65312327, 6.65450915, 6.65587523, 6.65722181,      6.65854914, 6.65985749, 6.66114712, 6.66241831, 6.6636713 ,       6.66490634, 6.66612369, 6.6673236 , 6.66850631, 6.66967205,       6.67082107, 6.6719536 , 6.67306987, 6.67417011, 6.67525455,       6.6763234 , 6.67737688, 6.67841522, 6.67943862, 6.68044729,       6.68144145, 6.68242129, 6.68338702, 6.68433884, 6.68527694,       6.68620152, 6.68711277, 6.68801087, 6.68889602, 6.6897684 ,       6.69062818, 6.69147555, 6.69231068, 6.69313375, 6.69394493,      6.69474438, 6.69553227, 6.69630877, 6.69707405, 6.69782825,       6.69857153, 6.69930406, 6.70002599, 6.70073746, 6.70143863,       6.70212964, 6.70281064, 6.70348177, 6.70414318, 6.70479499,       6.70543736, 6.7060704 , 6.70669427, 6.70730908, 6.70791497,       6.70851207, 6.7091005 , 6.70968038, 6.71025185, 6.71081501,       6.71137   , 6.71191692, 6.71245589, 6.71298703, 6.71351045,       6.71402626, 6.71453457, 6.71503549, 6.71552912, 6.71601557,       6.71649494, 6.71696733, 6.71743286, 6.7178916 , 6.71834367,       6.71878915, 6.71922815, 6.71966076, 6.72008706, 6.72050715,       6.72092113, 6.72132907, 6.72173106, 6.7221272 , 6.72251756,       6.72290223, 6.7232813 , 6.72365484, 6.72402292, 6.72438565,       6.72474308, 6.72509529, 6.72544237, 6.72578438, 6.7261214 ,      6.72645351, 6.72678077, 6.72710325, 6.72742102, 6.72773415,      6.72804271, 6.72834677, 6.72864638, 6.72894162, 6.72923255,      6.72951923, 6.72980171, 6.73008008, 6.73035437, 6.73062466,       6.73089099, 6.73115344, 6.73141205, 6.73166688, 6.73191798,       6.73216541, 6.73240923, 6.73264948, 6.73288621, 6.73311949,       6.73334935, 6.73357585, 6.73379904, 6.73401897, 6.73423567,       6.73444921, 6.73465962, 6.73486696, 6.73507126, 6.73527257,       6.73547093, 6.73566639, 6.73585899, 6.73604877, 6.73623578,       6.73642004, 6.73660161, 6.73678052, 6.73695682, 6.73713053,       6.73730169, 6.73747035, 6.73763654, 6.7378003 , 6.73796166,       6.73812065, 6.73827732, 6.73843169, 6.7385838 , 6.73873369,       6.73888137, 6.7390269 , 6.73917029, 6.73931158, 6.7394508 ,       6.73958798, 6.73972315, 6.73985634, 6.73998758, 6.74011689,       6.74024431, 6.74036986, 6.74049358, 6.74061547, 6.74073559,       6.74085394, 6.74097055, 6.74108546, 6.74119868, 6.74131025,       6.74142017, 6.74152849, 6.74163522, 6.74174038, 6.741844  ,       6.7419461 , 6.74204671, 6.74214583, 6.74224351, 6.74233975,      6.74243458, 6.74252803, 6.7426201 , 6.74271082, 6.74280021,       6.74288828, 6.74297507, 6.74306058, 6.74314484, 6.74322787,      6.74330967, 6.74339028, 6.7434697 , 6.74354796, 6.74362507,       6.74370105, 6.74377591, 6.74384968, 6.74392236, 6.74399398, 6.74406454, 6.74413407, 6.74420258, 6.74427009, 6.7443366 , 6.74440214, 6.74446672, 6.74453035, 6.74459305, 6.74465482, 6.74471569, 6.74477567, 6.74483476, 6.74489299, 6.74495036, 6.74500689, 6.7450626 , 6.74511748, 6.74517156, 6.74522485, 6.74527735, 6.74532908, 6.74538005, 6.74543028, 6.74547977,6.74552853, 6.74557657, 6.74562391, 6.74567056, 6.74571652,6.7457618 , 6.74580643, 6.74585039, 6.74589371, 6.7459364 ,6.74597846, 6.7460199 , 6.74606073, 6.74610096, 6.7461406 ,6.74617966, 6.74621815, 6.74625607, 6.74629344, 6.74633025,6.74636653, 6.74640227, 6.74643749, 6.74647219, 6.74650638,6.74654007, 6.74657326, 6.74660597, 6.7466382 , 6.74666995,6.74670124, 6.74673207, 6.74676244, 6.74679237, 6.74682186,6.74685092, 6.74687955, 6.74690776, 6.74693556, 6.74696294,6.74698993, 6.74701652, 6.74704272, 6.74706853, 6.74709396,6.74711902];
Xt=Xkb(1,:);
Nsamples=500;
dt = .048;
t=0:dt:dt*Nsamples;
Xkp = [4;0];
Xk=[];
Phi = [1 dt; 0 1]; 
sm = 1;
P = [sm^2 0; 0 sm^2];
Q = [0 0; 0 0];
M = [1 0]; 
R = 1;
Xkb = zeros(2,Nsamples+1);
Xkb(:,1) = Xkp;
noise = zeros(1,Nsamples+1);
for k=1:Nsamples
    Z = Xt(k+1)+randn;
    noise(k+1) = Z;
    P1 = Phi*P*Phi' + Q;
    S = M*P1*M' + R;
    K = P1*M'*inv(S);
    P = P1 - K*M*P1;   
    Xk = Phi*Xkp + K*(Z-M*Phi*Xkp);
    Xkb(:,k+1) = Xk;
    Xkp = Xk; 
end;
figure;
plot(t,Xt,'g');
hold on;
plot(t,noise,'c');
plot(t,Xkb(1,:),'m');
title('BACTERIA GROWTH estimation results');
xlabel('Time (s)');
ylabel('Bacteria growth');
%legend('True Growth','Measurements of growth','Kalman growth estimate');
S1=zeros(501,1);
for i=2:length(Xkb)-1
    a1=(Xkb(1,i+1)-Xkb(1,i));
    a2=((Xkb(1,i+1))-(2*(Xkb(1,i)))+(Xkb(1,i-1)));
    a3=(Xkb(1,i)-Xkb(1,i-1));
    S1(i-1)=((a1)-(.0000000011253)*dt*(a2)/a3)/dt;
end

q = zeros(1,500);
umax=.033*(298-277.69)^2;
Xmax=.608*298.5-11.4;
for i=1:499
    q(i)=S1(i)/(umax*Xkb(1,i)*(1-Xkb(1,i)/Xmax)-S1(i));
end
q2=(q-q1*298*298*298+.2565*298-24.82)/(298^2);
q22=mean(q2)
q222=std(q2)









%Xt=[4.8       , 4.82036581, 4.8406043 , 4.86071447, 4.88069537,4.90054609, 4.92026575, 4.93985352, 4.9593086 , 4.97863024,4.99781772, 5.01687038, 5.03578756, 5.05456866, 5.07321313,       5.09172045, 5.11009011, 5.12832167, 5.14641472, 5.16436888,       5.1821838 , 5.19985917, 5.21739474, 5.23479024, 5.25204549,       5.26916031, 5.28613456, 5.30296814, 5.31966098, 5.33621303,       5.35262427, 5.36889474, 5.38502449, 5.40101358, 5.41686213,      5.43257028, 5.44813819, 5.46356606, 5.47885409, 5.49400254,      5.50901168, 5.5238818 , 5.53861323, 5.5532063 , 5.56766138,       5.58197888, 5.59615919, 5.61020275, 5.62411002, 5.63788148,       5.65151762, 5.66501896, 5.67838602, 5.69161938, 5.70471959,       5.71768725, 5.73052296, 5.74322734, 5.75580103, 5.76824468,       5.78055896, 5.79274455, 5.80480214, 5.81673245, 5.8285362 ,       5.84021411, 5.85176693, 5.86319541, 5.87450033, 5.88568246,       5.89674259, 5.90768151, 5.91850002, 5.92919894, 5.93977909,       5.95024129, 5.96058639, 5.97081523, 5.98092865, 5.99092751,       6.00081266, 6.01058498, 6.02024533, 6.02979459, 6.03923363,       6.04856334, 6.0577846 , 6.0668983 , 6.07590534, 6.08480659,       6.09360297, 6.10229536, 6.11088467, 6.11937179, 6.12775763,       6.13604308, 6.14422904, 6.15231642, 6.16030612, 6.16819904,       6.17599607, 6.18369812, 6.19130608, 6.19882085, 6.20624332,       6.21357439, 6.22081494, 6.22796587, 6.23502805, 6.24200237,       6.24888972, 6.25569096, 6.26240697, 6.26903863, 6.27558679,       6.28205232, 6.28843609, 6.29473894, 6.30096174, 6.30710531,       6.31317052, 6.31915819, 6.32506916, 6.33090427, 6.33666433,       6.34235016, 6.34796259, 6.35350241, 6.35897044, 6.36436747,       6.36969429, 6.37495171, 6.38014049, 6.38526142, 6.39031527,       6.39530281, 6.4002248 , 6.40508199, 6.40987513, 6.41460497,       6.41927224, 6.42387768, 6.42842201, 6.43290596, 6.43733023,       6.44169554, 6.44600258, 6.45025207, 6.45444467, 6.45858109,       6.46266199, 6.46668805, 6.47065993, 6.4745783 , 6.47844381,       6.4822571 , 6.48601883, 6.48972961, 6.49339009, 6.49700088,       6.5005626 , 6.50407587, 6.50754129, 6.51095946, 6.51433097,       6.5176564 , 6.52093635, 6.52417138, 6.52736206, 6.53050896,       6.53361264, 6.53667364, 6.53969251, 6.54266979, 6.54560602,       6.54850172, 6.55135742, 6.55417363, 6.55695087, 6.55968964,       6.56239043, 6.56505376, 6.56768009, 6.57026992, 6.57282373,      6.57534198, 6.57782515, 6.58027369, 6.58268807, 6.58506873,      6.58741612, 6.58973068, 6.59201284, 6.59426305, 6.59648171,      6.59866926, 6.60082611, 6.60295266, 6.60504933, 6.60711652,      6.60915461, 6.61116401, 6.6131451 , 6.61509825, 6.61702385,      6.61892228, 6.62079389, 6.62263905, 6.62445811, 6.62625145,      6.6280194 , 6.6297623 , 6.63148051, 6.63317436, 6.63484417,      6.63649029, 6.63811303, 6.63971272, 6.64128966, 6.64284418,      6.64437658, 6.64588717, 6.64737624, 6.64884409, 6.65029102,      6.65171732, 6.65312327, 6.65450915, 6.65587523, 6.65722181,      6.65854914, 6.65985749, 6.66114712, 6.66241831, 6.6636713 ,       6.66490634, 6.66612369, 6.6673236 , 6.66850631, 6.66967205,       6.67082107, 6.6719536 , 6.67306987, 6.67417011, 6.67525455,       6.6763234 , 6.67737688, 6.67841522, 6.67943862, 6.68044729,       6.68144145, 6.68242129, 6.68338702, 6.68433884, 6.68527694,       6.68620152, 6.68711277, 6.68801087, 6.68889602, 6.6897684 ,       6.69062818, 6.69147555, 6.69231068, 6.69313375, 6.69394493,      6.69474438, 6.69553227, 6.69630877, 6.69707405, 6.69782825,       6.69857153, 6.69930406, 6.70002599, 6.70073746, 6.70143863,       6.70212964, 6.70281064, 6.70348177, 6.70414318, 6.70479499,       6.70543736, 6.7060704 , 6.70669427, 6.70730908, 6.70791497,       6.70851207, 6.7091005 , 6.70968038, 6.71025185, 6.71081501,       6.71137   , 6.71191692, 6.71245589, 6.71298703, 6.71351045,       6.71402626, 6.71453457, 6.71503549, 6.71552912, 6.71601557,       6.71649494, 6.71696733, 6.71743286, 6.7178916 , 6.71834367,       6.71878915, 6.71922815, 6.71966076, 6.72008706, 6.72050715,       6.72092113, 6.72132907, 6.72173106, 6.7221272 , 6.72251756,       6.72290223, 6.7232813 , 6.72365484, 6.72402292, 6.72438565,       6.72474308, 6.72509529, 6.72544237, 6.72578438, 6.7261214 ,      6.72645351, 6.72678077, 6.72710325, 6.72742102, 6.72773415,      6.72804271, 6.72834677, 6.72864638, 6.72894162, 6.72923255,      6.72951923, 6.72980171, 6.73008008, 6.73035437, 6.73062466,       6.73089099, 6.73115344, 6.73141205, 6.73166688, 6.73191798,       6.73216541, 6.73240923, 6.73264948, 6.73288621, 6.73311949,       6.73334935, 6.73357585, 6.73379904, 6.73401897, 6.73423567,       6.73444921, 6.73465962, 6.73486696, 6.73507126, 6.73527257,       6.73547093, 6.73566639, 6.73585899, 6.73604877, 6.73623578,       6.73642004, 6.73660161, 6.73678052, 6.73695682, 6.73713053,       6.73730169, 6.73747035, 6.73763654, 6.7378003 , 6.73796166,       6.73812065, 6.73827732, 6.73843169, 6.7385838 , 6.73873369,       6.73888137, 6.7390269 , 6.73917029, 6.73931158, 6.7394508 ,       6.73958798, 6.73972315, 6.73985634, 6.73998758, 6.74011689,       6.74024431, 6.74036986, 6.74049358, 6.74061547, 6.74073559,       6.74085394, 6.74097055, 6.74108546, 6.74119868, 6.74131025,       6.74142017, 6.74152849, 6.74163522, 6.74174038, 6.741844  ,       6.7419461 , 6.74204671, 6.74214583, 6.74224351, 6.74233975,      6.74243458, 6.74252803, 6.7426201 , 6.74271082, 6.74280021,       6.74288828, 6.74297507, 6.74306058, 6.74314484, 6.74322787,      6.74330967, 6.74339028, 6.7434697 , 6.74354796, 6.74362507,       6.74370105, 6.74377591, 6.74384968, 6.74392236, 6.74399398, 6.74406454, 6.74413407, 6.74420258, 6.74427009, 6.7443366 , 6.74440214, 6.74446672, 6.74453035, 6.74459305, 6.74465482, 6.74471569, 6.74477567, 6.74483476, 6.74489299, 6.74495036, 6.74500689, 6.7450626 , 6.74511748, 6.74517156, 6.74522485, 6.74527735, 6.74532908, 6.74538005, 6.74543028, 6.74547977,6.74552853, 6.74557657, 6.74562391, 6.74567056, 6.74571652,6.7457618 , 6.74580643, 6.74585039, 6.74589371, 6.7459364 ,6.74597846, 6.7460199 , 6.74606073, 6.74610096, 6.7461406 ,6.74617966, 6.74621815, 6.74625607, 6.74629344, 6.74633025,6.74636653, 6.74640227, 6.74643749, 6.74647219, 6.74650638,6.74654007, 6.74657326, 6.74660597, 6.7466382 , 6.74666995,6.74670124, 6.74673207, 6.74676244, 6.74679237, 6.74682186,6.74685092, 6.74687955, 6.74690776, 6.74693556, 6.74696294,6.74698993, 6.74701652, 6.74704272, 6.74706853, 6.74709396,6.74711902];
Xt=Xkb(1,:);
Nsamples=500;
dt = .048;
t=0:dt:dt*Nsamples;
Xkp = [4;0];
Xk=[];
Phi = [1 dt; 0 1]; 
sm = 1;
P = [sm^2 0; 0 sm^2];
Q = [0 0; 0 0];
M = [1 0]; 
R = 1;
Xkb = zeros(2,Nsamples+1);
Xkb(:,1) = Xkp;
noise = zeros(1,Nsamples+1);
for k=1:Nsamples
    Z = Xt(k+1)+randn;
    noise(k+1) = Z;
    P1 = Phi*P*Phi' + Q;
    S = M*P1*M' + R;
    K = P1*M'*inv(S);
    P = P1 - K*M*P1;   
    Xk = Phi*Xkp + K*(Z-M*Phi*Xkp);
    Xkb(:,k+1) = Xk;
    Xkp = Xk; 
end;
figure;
plot(t,Xt,'g');
hold on;
plot(t,noise,'c');
plot(t,Xkb(1,:),'m');
title('BACTERIA GROWTH estimation results');
xlabel('Time (s)');
ylabel('Bacteria growth');
%legend('True Growth','Measurements of growth','Kalman growth estimate');
S1=zeros(501,1);
for i=2:length(Xkb)-1
    a1=(Xkb(1,i+1)-Xkb(1,i));
    a2=((Xkb(1,i+1))-(2*(Xkb(1,i)))+(Xkb(1,i-1)));
    a3=(Xkb(1,i)-Xkb(1,i-1));
    S1(i-1)=((a1)-(.0000000011253)*dt*(a2)/a3)/dt;
end

q = zeros(1,500);
umax=.033*(298-277.69)^2;
Xmax=.608*298.5-11.4;
for i=1:499
    q(i)=S1(i)/(umax*Xkb(1,i)*(1-Xkb(1,i)/Xmax)-S1(i));
end
q3=(q-q1*298*298*298-q2*298*298-24.82)/(298);
q33=mean(q3)
q333=std(q3)










%Xt=[4.8       , 4.82036581, 4.8406043 , 4.86071447, 4.88069537,4.90054609, 4.92026575, 4.93985352, 4.9593086 , 4.97863024,4.99781772, 5.01687038, 5.03578756, 5.05456866, 5.07321313,       5.09172045, 5.11009011, 5.12832167, 5.14641472, 5.16436888,       5.1821838 , 5.19985917, 5.21739474, 5.23479024, 5.25204549,       5.26916031, 5.28613456, 5.30296814, 5.31966098, 5.33621303,       5.35262427, 5.36889474, 5.38502449, 5.40101358, 5.41686213,      5.43257028, 5.44813819, 5.46356606, 5.47885409, 5.49400254,      5.50901168, 5.5238818 , 5.53861323, 5.5532063 , 5.56766138,       5.58197888, 5.59615919, 5.61020275, 5.62411002, 5.63788148,       5.65151762, 5.66501896, 5.67838602, 5.69161938, 5.70471959,       5.71768725, 5.73052296, 5.74322734, 5.75580103, 5.76824468,       5.78055896, 5.79274455, 5.80480214, 5.81673245, 5.8285362 ,       5.84021411, 5.85176693, 5.86319541, 5.87450033, 5.88568246,       5.89674259, 5.90768151, 5.91850002, 5.92919894, 5.93977909,       5.95024129, 5.96058639, 5.97081523, 5.98092865, 5.99092751,       6.00081266, 6.01058498, 6.02024533, 6.02979459, 6.03923363,       6.04856334, 6.0577846 , 6.0668983 , 6.07590534, 6.08480659,       6.09360297, 6.10229536, 6.11088467, 6.11937179, 6.12775763,       6.13604308, 6.14422904, 6.15231642, 6.16030612, 6.16819904,       6.17599607, 6.18369812, 6.19130608, 6.19882085, 6.20624332,       6.21357439, 6.22081494, 6.22796587, 6.23502805, 6.24200237,       6.24888972, 6.25569096, 6.26240697, 6.26903863, 6.27558679,       6.28205232, 6.28843609, 6.29473894, 6.30096174, 6.30710531,       6.31317052, 6.31915819, 6.32506916, 6.33090427, 6.33666433,       6.34235016, 6.34796259, 6.35350241, 6.35897044, 6.36436747,       6.36969429, 6.37495171, 6.38014049, 6.38526142, 6.39031527,       6.39530281, 6.4002248 , 6.40508199, 6.40987513, 6.41460497,       6.41927224, 6.42387768, 6.42842201, 6.43290596, 6.43733023,       6.44169554, 6.44600258, 6.45025207, 6.45444467, 6.45858109,       6.46266199, 6.46668805, 6.47065993, 6.4745783 , 6.47844381,       6.4822571 , 6.48601883, 6.48972961, 6.49339009, 6.49700088,       6.5005626 , 6.50407587, 6.50754129, 6.51095946, 6.51433097,       6.5176564 , 6.52093635, 6.52417138, 6.52736206, 6.53050896,       6.53361264, 6.53667364, 6.53969251, 6.54266979, 6.54560602,       6.54850172, 6.55135742, 6.55417363, 6.55695087, 6.55968964,       6.56239043, 6.56505376, 6.56768009, 6.57026992, 6.57282373,      6.57534198, 6.57782515, 6.58027369, 6.58268807, 6.58506873,      6.58741612, 6.58973068, 6.59201284, 6.59426305, 6.59648171,      6.59866926, 6.60082611, 6.60295266, 6.60504933, 6.60711652,      6.60915461, 6.61116401, 6.6131451 , 6.61509825, 6.61702385,      6.61892228, 6.62079389, 6.62263905, 6.62445811, 6.62625145,      6.6280194 , 6.6297623 , 6.63148051, 6.63317436, 6.63484417,      6.63649029, 6.63811303, 6.63971272, 6.64128966, 6.64284418,      6.64437658, 6.64588717, 6.64737624, 6.64884409, 6.65029102,      6.65171732, 6.65312327, 6.65450915, 6.65587523, 6.65722181,      6.65854914, 6.65985749, 6.66114712, 6.66241831, 6.6636713 ,       6.66490634, 6.66612369, 6.6673236 , 6.66850631, 6.66967205,       6.67082107, 6.6719536 , 6.67306987, 6.67417011, 6.67525455,       6.6763234 , 6.67737688, 6.67841522, 6.67943862, 6.68044729,       6.68144145, 6.68242129, 6.68338702, 6.68433884, 6.68527694,       6.68620152, 6.68711277, 6.68801087, 6.68889602, 6.6897684 ,       6.69062818, 6.69147555, 6.69231068, 6.69313375, 6.69394493,      6.69474438, 6.69553227, 6.69630877, 6.69707405, 6.69782825,       6.69857153, 6.69930406, 6.70002599, 6.70073746, 6.70143863,       6.70212964, 6.70281064, 6.70348177, 6.70414318, 6.70479499,       6.70543736, 6.7060704 , 6.70669427, 6.70730908, 6.70791497,       6.70851207, 6.7091005 , 6.70968038, 6.71025185, 6.71081501,       6.71137   , 6.71191692, 6.71245589, 6.71298703, 6.71351045,       6.71402626, 6.71453457, 6.71503549, 6.71552912, 6.71601557,       6.71649494, 6.71696733, 6.71743286, 6.7178916 , 6.71834367,       6.71878915, 6.71922815, 6.71966076, 6.72008706, 6.72050715,       6.72092113, 6.72132907, 6.72173106, 6.7221272 , 6.72251756,       6.72290223, 6.7232813 , 6.72365484, 6.72402292, 6.72438565,       6.72474308, 6.72509529, 6.72544237, 6.72578438, 6.7261214 ,      6.72645351, 6.72678077, 6.72710325, 6.72742102, 6.72773415,      6.72804271, 6.72834677, 6.72864638, 6.72894162, 6.72923255,      6.72951923, 6.72980171, 6.73008008, 6.73035437, 6.73062466,       6.73089099, 6.73115344, 6.73141205, 6.73166688, 6.73191798,       6.73216541, 6.73240923, 6.73264948, 6.73288621, 6.73311949,       6.73334935, 6.73357585, 6.73379904, 6.73401897, 6.73423567,       6.73444921, 6.73465962, 6.73486696, 6.73507126, 6.73527257,       6.73547093, 6.73566639, 6.73585899, 6.73604877, 6.73623578,       6.73642004, 6.73660161, 6.73678052, 6.73695682, 6.73713053,       6.73730169, 6.73747035, 6.73763654, 6.7378003 , 6.73796166,       6.73812065, 6.73827732, 6.73843169, 6.7385838 , 6.73873369,       6.73888137, 6.7390269 , 6.73917029, 6.73931158, 6.7394508 ,       6.73958798, 6.73972315, 6.73985634, 6.73998758, 6.74011689,       6.74024431, 6.74036986, 6.74049358, 6.74061547, 6.74073559,       6.74085394, 6.74097055, 6.74108546, 6.74119868, 6.74131025,       6.74142017, 6.74152849, 6.74163522, 6.74174038, 6.741844  ,       6.7419461 , 6.74204671, 6.74214583, 6.74224351, 6.74233975,      6.74243458, 6.74252803, 6.7426201 , 6.74271082, 6.74280021,       6.74288828, 6.74297507, 6.74306058, 6.74314484, 6.74322787,      6.74330967, 6.74339028, 6.7434697 , 6.74354796, 6.74362507,       6.74370105, 6.74377591, 6.74384968, 6.74392236, 6.74399398, 6.74406454, 6.74413407, 6.74420258, 6.74427009, 6.7443366 , 6.74440214, 6.74446672, 6.74453035, 6.74459305, 6.74465482, 6.74471569, 6.74477567, 6.74483476, 6.74489299, 6.74495036, 6.74500689, 6.7450626 , 6.74511748, 6.74517156, 6.74522485, 6.74527735, 6.74532908, 6.74538005, 6.74543028, 6.74547977,6.74552853, 6.74557657, 6.74562391, 6.74567056, 6.74571652,6.7457618 , 6.74580643, 6.74585039, 6.74589371, 6.7459364 ,6.74597846, 6.7460199 , 6.74606073, 6.74610096, 6.7461406 ,6.74617966, 6.74621815, 6.74625607, 6.74629344, 6.74633025,6.74636653, 6.74640227, 6.74643749, 6.74647219, 6.74650638,6.74654007, 6.74657326, 6.74660597, 6.7466382 , 6.74666995,6.74670124, 6.74673207, 6.74676244, 6.74679237, 6.74682186,6.74685092, 6.74687955, 6.74690776, 6.74693556, 6.74696294,6.74698993, 6.74701652, 6.74704272, 6.74706853, 6.74709396,6.74711902];
Xt=Xkb(1,:);
Nsamples=500;
dt = .048;
t=0:dt:dt*Nsamples;
Xkp = [4;0];
Xk=[];
Phi = [1 dt; 0 1]; 
sm = 1;
P = [sm^2 0; 0 sm^2];
Q = [0 0; 0 0];
M = [1 0]; 
R = 1;
Xkb = zeros(2,Nsamples+1);
Xkb(:,1) = Xkp;
noise = zeros(1,Nsamples+1);
for k=1:Nsamples
    Z = Xt(k+1)+randn;
    noise(k+1) = Z;
    P1 = Phi*P*Phi' + Q;
    S = M*P1*M' + R;
    K = P1*M'*inv(S);
    P = P1 - K*M*P1;   
    Xk = Phi*Xkp + K*(Z-M*Phi*Xkp);
    Xkb(:,k+1) = Xk;
    Xkp = Xk; 
end;
figure;
plot(t,Xt,'g');
hold on;
plot(t,noise,'c');
plot(t,Xkb(1,:),'m');
title('BACTERIA GROWTH estimation results');
xlabel('Time (s)');
ylabel('Bacteria growth');
%legend('True Growth','Measurements of growth','Kalman growth estimate');
S1=zeros(501,1);
for i=2:length(Xkb)-1
    a1=(Xkb(1,i+1)-Xkb(1,i));
    a2=((Xkb(1,i+1))-(2*(Xkb(1,i)))+(Xkb(1,i-1)));
    a3=(Xkb(1,i)-Xkb(1,i-1));
    S1(i-1)=((a1)-(.0000000011253)*dt*(a2)/a3)/dt;
end

q = zeros(1,500);
umax=.033*(298-277.69)^2;
Xmax=.608*298.5-11.4;
for i=1:499
    q(i)=S1(i)/(umax*Xkb(1,i)*(1-Xkb(1,i)/Xmax)-S1(i));
end
q4=(q-q1*298*298*298-q2*298*298-q3*298)/(1);
q44=mean(q4)
q444=std(q4)











